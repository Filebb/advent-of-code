---
title: "Day 6: Probably a Fire Hazard"
---

[Reference](https://adventofcode.com/2015/day/6)

```{r}
#| label: 2015 - day 6 - load data

library(tidyverse)
library(scales)

input <- read_lines(file = "inputs/2015/06.txt")
```

## Part One

::: {.panel-tabset}

## Solution

```{r}
#| label: 2015 - day 6 - part 1

instructions <- tibble(raw = input) |> 
    mutate(instruction = str_extract(raw, "toggle|turn on|turn off"),
           position = str_extract_all(raw, "[0-9]+")) |> 
    unnest_wider(position, names_sep = "_") |> 
    mutate(across(starts_with("position"), \(x) as.integer(x) + 1L)) |> 
    mutate(x_range = map2(position_1, position_3, \(a, b) a:b),
           y_range = map2(position_2, position_4, \(a, b) a:b))

action <- function(instruction, x_range, y_range, grid) {
    grid[x_range, y_range] <- switch(
        instruction,
        "toggle"   = !grid[x_range, y_range],
        "turn on"  = TRUE,
        "turn off" = FALSE
    )
    return(grid)
}

lights <- instructions |> 
    mutate(
        grid = accumulate(
            .x = row_number(),
            .f = \(grid, i) action(
                instruction = instruction[i],
                x_range     = x_range[[i]],
                y_range     = y_range[[i]],
                grid        = grid
            ),
            .init = matrix(FALSE, 1e3, 1e3)
        ) |> tail(-1) # Remove the initial grid (.init) from results
    ) |>  
    mutate(lights_on = map_int(grid, sum))

total_lights_on <- lights |> tail(1) |> pull(lights_on)
cat("Total lights on:", total_lights_on, "\n")
```

## Full Table

```{r}
#| label: 2015 - day 6 - part 1 full table
#| echo: false

lights |> 
    select(-x_range, -y_range, -grid) |> 
    rmarkdown::paged_table()
```

## Plot

```{r}
#| label: 2015 - day 6 - part 1 plot
#| echo: false

lights |> 
    ggplot(aes(x = seq_along(lights_on), y = lights_on)) +
    geom_line() +
    scale_y_continuous(labels = scales::label_number(scale_cut = cut_short_scale())) +
    theme_bw() +
    labs(x = "step", y = "# lights on")
```

:::

## Part Two

::: {.panel-tabset}

## Solution

```{r}
#| label: 2015 - day 6 - part 2

new_action <- function(instruction, x_range, y_range, grid) {
    grid[x_range, y_range] <- switch(
        instruction,
        "toggle"   = grid[x_range, y_range] + 2,
        "turn on"  = grid[x_range, y_range] + 1,
        "turn off" = pmax(grid[x_range, y_range] - 1, 0)
    )
    return(grid)
}

brightness <- instructions |> 
    mutate(
        grid = accumulate(
            .x = row_number(),
            .f = \(grid, i) new_action(
                instruction = instruction[i],
                x_range     = x_range[[i]],
                y_range     = y_range[[i]],
                grid        = grid
            ),
            .init = matrix(0, 1e3, 1e3)
        ) |> tail(-1) # Remove the initial grid (.init) from results
    ) |>  
    mutate(brightness = map_int(grid, sum))

total_brightness <- brightness |> tail(1) |> pull(brightness)
cat("Total brightness:", total_brightness, "\n")
```

## Full Table

```{r}
#| label: 2015 - day 6 - part 2 full table
#| echo: false

brightness |> 
    select(-x_range, -y_range, -grid) |> 
    rmarkdown::paged_table()
```

## Plot

```{r}
#| label: 2015 - day 6 - part 2 plot
#| echo: false

brightness |> 
    ggplot(aes(x = seq_along(brightness), y = brightness)) +
    geom_line() +
    scale_y_continuous(labels = scales::label_number(scale_cut = cut_short_scale())) +
    theme_bw() +
    labs(x = "step", y = "total brightness")
```

:::
